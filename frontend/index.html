<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parakeet ASR - Real-time Speech Recognition</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ü¶ú Parakeet ASR</h1>
            <p class="subtitle">Real-time Speech Recognition (parakeet-tdt-0.6b-v3)</p>
        </header>

        <!-- Connection Section -->
        <section class="connection-section card">
            <h2>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–æ—Ä–∫–µ—Ä—É</h2>
            
            <!-- Step 1: Launch Worker -->
            <div class="connection-step">
                <h3>–®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–æ—Ä–∫–µ—Ä –Ω–∞ RunPod</h3>
                <div class="runpod-config">
                    <div class="input-row">
                        <div class="input-group">
                            <label for="runpod-api-key">API Key:</label>
                            <input type="password" id="runpod-api-key" placeholder="rpa_XXXXXXXXXXXX">
                        </div>
                        <div class="input-group">
                            <label for="runpod-endpoint-id">Endpoint ID:</label>
                            <input type="text" id="runpod-endpoint-id" value="j9y5ancy39k1th" placeholder="abc123xyz">
                        </div>
                    </div>
                    <div class="button-group">
                        <button id="launch-worker-btn" class="btn btn-primary">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–æ—Ä–∫–µ—Ä</button>
                        <button id="stop-worker-btn" class="btn btn-danger" disabled>‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                    </div>
                    <div id="worker-status" class="worker-status">
                        <span class="status-text">–í–æ—Ä–∫–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω</span>
                    </div>
                </div>
            </div>

            <!-- Step 2: Connect WebSocket -->
            <div class="connection-step">
                <h3>–®–∞–≥ 2: –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ WebSocket</h3>
                <p class="hint">–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤–æ—Ä–∫–µ—Ä–∞, —Å–∫–æ–ø–∏—Ä—É–π IP –∏ –ø–æ—Ä—Ç –∏–∑ RunPod Dashboard ‚Üí Pods ‚Üí —Ç–≤–æ–π Pod</p>
                <div class="connection-form">
                    <div class="input-group">
                        <label for="ws-url">WebSocket URL:</label>
                        <input type="text" id="ws-url" placeholder="ws://IP:8765">
                    </div>
                    <div class="button-group">
                        <button id="connect-btn" class="btn btn-success">üîå –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
                        <button id="disconnect-btn" class="btn btn-secondary" disabled>–û—Ç–∫–ª—é—á–∏—Ç—å—Å—è</button>
                        <button id="healthcheck-btn" class="btn btn-info" disabled>Ping</button>
                    </div>
                </div>
            </div>

            <div id="connection-status" class="status status-disconnected">
                <span class="status-dot"></span>
                <span class="status-text">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</span>
            </div>
            <div id="model-info" class="model-info hidden"></div>
        </section>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="realtime">üé§ Real-time (–ú–∏–∫—Ä–æ—Ñ–æ–Ω)</button>
            <button class="tab-btn" data-tab="batch">üìÅ Batch (–§–∞–π–ª)</button>
        </div>

        <!-- Real-time Tab -->
        <section id="realtime-tab" class="tab-content active">
            <div class="card">
                <h2>Real-time Streaming</h2>
                
                <!-- Settings -->
                <div class="settings-grid">
                    <div class="setting">
                        <label for="chunk-size">–†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞ (–º—Å):</label>
                        <input type="range" id="chunk-size" min="100" max="5000" value="500" step="100">
                        <span id="chunk-size-value">500 –º—Å</span>
                    </div>
                    <div class="setting">
                        <label for="sample-rate">Sample Rate:</label>
                        <select id="sample-rate">
                            <option value="16000" selected>16000 Hz</option>
                            <option value="44100">44100 Hz</option>
                            <option value="48000">48000 Hz</option>
                        </select>
                    </div>
                    <div class="setting">
                        <label>
                            <input type="checkbox" id="show-timestamps" checked>
                            –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å timestamps
                        </label>
                    </div>
                </div>

                <!-- Controls -->
                <div class="controls">
                    <button id="start-recording" class="btn btn-success btn-large" disabled>
                        <span class="icon">üéôÔ∏è</span>
                        –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å
                    </button>
                    <button id="stop-recording" class="btn btn-danger btn-large" disabled>
                        <span class="icon">‚èπÔ∏è</span>
                        –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>

                <!-- Audio Visualizer -->
                <div class="visualizer-container">
                    <canvas id="audio-visualizer" width="800" height="100"></canvas>
                </div>

                <!-- Stats -->
                <div class="stats-panel">
                    <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <div class="stats-grid">
                        <div class="stat">
                            <span class="stat-label">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–∞–Ω–∫–æ–≤:</span>
                            <span id="stat-chunks-sent" class="stat-value">0</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">–ü–æ–ª—É—á–µ–Ω–æ –æ—Ç–≤–µ—Ç–æ–≤:</span>
                            <span id="stat-responses" class="stat-value">0</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">–°—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞:</span>
                            <span id="stat-avg-latency" class="stat-value">- –º—Å</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">–ú–∏–Ω. –∑–∞–¥–µ—Ä–∂–∫–∞:</span>
                            <span id="stat-min-latency" class="stat-value">- –º—Å</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">–ú–∞–∫—Å. –∑–∞–¥–µ—Ä–∂–∫–∞:</span>
                            <span id="stat-max-latency" class="stat-value">- –º—Å</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">RTF (Real-Time Factor):</span>
                            <span id="stat-rtf" class="stat-value">-</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">–í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏:</span>
                            <span id="stat-recording-time" class="stat-value">0:00</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:</span>
                            <span id="stat-processing-time" class="stat-value">0 –º—Å</span>
                        </div>
                    </div>
                </div>

                <!-- Transcription Output -->
                <div class="transcription-output">
                    <h3>–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è</h3>
                    <div id="realtime-transcription" class="transcription-text"></div>
                </div>
            </div>
        </section>

        <!-- Batch Tab -->
        <section id="batch-tab" class="tab-content">
            <div class="card">
                <h2>Batch –û–±—Ä–∞–±–æ—Ç–∫–∞</h2>

                <!-- File Upload -->
                <div class="file-upload-area" id="drop-zone">
                    <input type="file" id="file-input" accept="audio/*" hidden>
                    <div class="upload-content">
                        <span class="upload-icon">üìÇ</span>
                        <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ <button id="browse-btn" class="btn-link">–≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</button></p>
                        <p class="upload-hint">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: WAV, MP3, FLAC, OGG, WebM</p>
                    </div>
                </div>

                <!-- File Info -->
                <div id="file-info" class="file-info hidden">
                    <div class="file-details">
                        <span class="file-name" id="file-name"></span>
                        <span class="file-duration" id="file-duration"></span>
                        <span class="file-size" id="file-size"></span>
                    </div>
                    <audio id="audio-preview" controls></audio>
                </div>

                <!-- Batch Settings -->
                <div class="batch-settings hidden" id="batch-settings">
                    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏</h3>
                    <div class="settings-grid">
                        <div class="setting">
                            <label>
                                <input type="radio" name="process-mode" value="whole" checked>
                                –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ü–µ–ª–∏–∫–æ–º
                            </label>
                        </div>
                        <div class="setting">
                            <label>
                                <input type="radio" name="process-mode" value="chunks">
                                –†–∞–∑–±–∏—Ç—å –Ω–∞ —á–∞–Ω–∫–∏ (FFmpeg WASM)
                            </label>
                        </div>
                    </div>
                    
                    <div id="chunk-settings" class="chunk-settings hidden">
                        <div class="setting">
                            <label for="batch-chunk-size">–†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞ (—Å–µ–∫):</label>
                            <input type="range" id="batch-chunk-size" min="5" max="120" value="30" step="5">
                            <span id="batch-chunk-size-value">30 —Å–µ–∫</span>
                        </div>
                        <div class="setting">
                            <label for="overlap-size">–ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ (—Å–µ–∫):</label>
                            <input type="range" id="overlap-size" min="0" max="5" value="1" step="0.5">
                            <span id="overlap-size-value">1 —Å–µ–∫</span>
                        </div>
                        <div class="setting">
                            <label for="parallel-chunks">–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:</label>
                            <input type="number" id="parallel-chunks" min="1" max="5" value="1">
                        </div>
                    </div>

                    <button id="start-batch" class="btn btn-primary btn-large" disabled>
                        üöÄ –ù–∞—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É
                    </button>
                </div>

                <!-- Progress -->
                <div id="batch-progress" class="batch-progress hidden">
                    <h3>–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏</h3>
                    
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progress-bar"></div>
                        <span class="progress-text" id="progress-text">0%</span>
                    </div>

                    <div class="batch-stats">
                        <div class="stat">
                            <span class="stat-label">–ß–∞–Ω–∫–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:</span>
                            <span id="batch-chunks-done" class="stat-value">0 / 0</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">–í—Ä–µ–º—è –Ω–∞ —á–∞–Ω–∫:</span>
                            <span id="batch-time-per-chunk" class="stat-value">- —Å–µ–∫</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">RTF:</span>
                            <span id="batch-rtf" class="stat-value">-</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">–û—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è:</span>
                            <span id="batch-eta" class="stat-value">-</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">–û–±—â–µ–µ –≤—Ä–µ–º—è:</span>
                            <span id="batch-total-time" class="stat-value">0 —Å–µ–∫</span>
                        </div>
                    </div>

                    <!-- Chunks List -->
                    <div class="chunks-list" id="chunks-list"></div>
                </div>

                <!-- Batch Transcription Output -->
                <div id="batch-output" class="transcription-output hidden">
                    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏</h3>
                    <div class="output-controls">
                        <button id="copy-result" class="btn btn-secondary">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button id="download-result" class="btn btn-secondary">üíæ –°–∫–∞—á–∞—Ç—å TXT</button>
                        <button id="download-srt" class="btn btn-secondary">üìÑ –°–∫–∞—á–∞—Ç—å SRT</button>
                    </div>
                    <div id="batch-transcription" class="transcription-text"></div>
                </div>
            </div>
        </section>

        <!-- Latency Chart -->
        <section class="card" id="latency-chart-section">
            <h2>–ì—Ä–∞—Ñ–∏–∫ –∑–∞–¥–µ—Ä–∂–µ–∫</h2>
            <canvas id="latency-chart" width="800" height="200"></canvas>
        </section>

        <!-- Console / Logs -->
        <section class="card">
            <h2>–õ–æ–≥–∏</h2>
            <div class="log-controls">
                <button id="clear-logs" class="btn btn-secondary">–û—á–∏—Å—Ç–∏—Ç—å</button>
                <label>
                    <input type="checkbox" id="auto-scroll" checked>
                    –ê–≤—Ç–æ-–ø—Ä–æ–∫—Ä—É—Ç–∫–∞
                </label>
            </div>
            <div id="logs" class="logs-container"></div>
        </section>
    </div>

    <!-- FFmpeg WASM -->
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.7/dist/umd/ffmpeg.js"></script>
    <script src="https://unpkg.com/@ffmpeg/util@0.12.1/dist/umd/util.js"></script>
    
    <!-- App Scripts -->
    <script src="audio-processor.js"></script>
    <script src="app.js"></script>
</body>
</html>
